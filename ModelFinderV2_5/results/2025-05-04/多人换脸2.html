
        <!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>æ¨¡å‹ä¸‹è½½é“¾æ¥ (Model Download Links)</title>
            <style>
                body { font-family: "Microsoft YaHei", Arial, sans-serif; margin: 20px; }
                table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
                th, td { border: 1px solid #ddd; padding: 8px; text-align: left; word-wrap: break-word; } /* Added word-wrap */
                th {
                    background-color: #f2f2f2;
                    position: sticky;
                    top: 0; /* Stick to the top */
                    z-index: 5; /* Ensure header is above table content */
                    cursor: pointer;
                    user-select: none;
                }
                th:hover { background-color: #e0e0e0; }
                th .filter-icon { margin-left: 5px; font-size: 12px; color: #666; }
                tr:nth-child(even) { background-color: #f9f9f9; }
                a { text-decoration: none; color: #0066cc; } /* Default link color */
                a:hover { text-decoration: underline; }
                .status-processed { color: green; font-weight: bold; }
                .status-notfound { color: red; }
                .status-error { color: orange; }
                .file-name { font-weight: bold; }
                /* Adjusted link column style */
                .link-col { max-width: 150px; text-align: center; font-size: 14px; }
                .link-col a { display: inline-block; padding: 2px 6px; border-radius: 3px; }
                .hf-link a { background-color: #ffe0cc; color: #ff6000; } /* HuggingFace */
                .mirror-link a { background-color: #cce0ff; color: #0066ff; } /* HF Mirror */
                .liblib-link a { background-color: #ccffcc; color: #00aa00; } /* LibLib */
                .no-link { color: #999; text-align: center; font-size: 14px; } /* Style for 'Ã—æš‚æ— ' */

                .summary { margin-top: 20px; padding: 10px; background-color: #f8f8f8; border-radius: 5px; }
                .section-title { font-size: 1.2em; margin-top: 30px; margin-bottom: 10px; font-weight: bold; }
                .controls-box { margin-bottom: 20px; padding: 10px; background: #f0f0f0; border-radius: 5px; display: flex; align-items: center; gap: 15px; flex-wrap: wrap; }
                #filterInput { padding: 5px; border: 1px solid #ccc; border-radius: 3px; }
                #copyButton {
                    padding: 5px 10px;
                    background-color: #4CAF50; /* Green */
                    color: white;
                    border: none;
                    border-radius: 3px;
                    cursor: pointer;
                    font-size: 14px;
                    transition: background-color 0.3s ease;
                }
                #copyButton:hover { background-color: #45a049; }
                #copyButton:disabled { background-color: #cccccc; cursor: not-allowed; }
                #copyMessage { margin-left: 10px; color: green; font-weight: bold; }

                .usage-guide {
                    margin-bottom: 15px; padding: 10px; background: #f8fff8;
                    border-left: 4px solid #00aa00; border-radius: 3px; font-size: 14px;
                }
                .usage-guide ul { margin: 5px 0 0 20px; padding: 0; }

                /* Dropdown styles */
                .dropdown-content {
                    display: none; position: absolute; background-color: white;
                    min-width: 160px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
                    z-index: 10; padding: 5px; border-radius: 3px;
                    max-height: 300px; overflow-y: auto; border: 1px solid #ccc;
                }
                .dropdown-content.show { display: block; }
                .dropdown-item { padding: 5px; cursor: pointer; display: flex; align-items: center; font-size: 14px; }
                .dropdown-item:hover { background-color: #f1f1f1; }
                .dropdown-item input[type='checkbox'] { margin-right: 8px; }
                .dropdown-search { width: 100%; box-sizing: border-box; padding: 5px; margin-bottom: 5px; border: 1px solid #ccc; border-radius: 3px; }
                .filter-buttons { display: flex; justify-content: space-between; margin-top: 5px; padding-top: 5px; border-top: 1px solid #eee; }
                .filter-apply, .filter-clear { padding: 3px 8px; cursor: pointer; background-color: #f0f0f0; border: 1px solid #ccc; border-radius: 3px; font-size: 12px; }
                .filter-apply:hover, .filter-clear:hover { background-color: #e0e0e0; }
            </style>
        </head>
        <body>
            <h1>æ¨¡å‹ä¸‹è½½é“¾æ¥ (Model Download Links)</h1>
        
            <p>æºæ–‡ä»¶ (Source File): å¤šäººæ¢è„¸2.csv</p>
            <p>ç”Ÿæˆæ—¶é—´ (Generated Time): 2025-05-04 19:13:58</p>

            <div class="usage-guide">
                <p><strong>ä½¿ç”¨è¯´æ˜ (Instructions):</strong></p>
                <ul>
                    <li>ç‚¹å‡»è¡¨æ ¼æ ‡é¢˜å¯ä»¥<strong>æ’åº</strong>åˆ—å†…å®¹ (Click table headers to <strong>sort</strong> columns)</li>
                    <li>ç‚¹å‡»è¡¨æ ¼æ ‡é¢˜å³ä¾§çš„ç­›é€‰å›¾æ ‡ <span class="filter-icon">â–¼</span> å¯ä»¥<strong>ç­›é€‰</strong>åˆ—å†…å®¹ (Click filter icon <span class="filter-icon">â–¼</span> next to headers to <strong>filter</strong> columns)</li>
                    <li>è¡¨æ ¼ä¸­ <span style="color: #0066cc;">âœ“ç‚¹æ­¤è·³è½¬</span> è¡¨ç¤ºæœ‰é“¾æ¥å¯ç‚¹å‡»ï¼Œ<span class="no-link">Ã—æš‚æ— </span> è¡¨ç¤ºæ— é“¾æ¥ (âœ“Link indicates a clickable link, Ã—NoLink means no link)</li>
                    <li><span class="hf-link" style="padding: 0 3px; border-radius: 3px;">âœ“HF</span> - è·³è½¬åˆ° HuggingFace æ¨¡å‹é¡µé¢ (Go to HuggingFace model page)</li>
                    <li><span class="mirror-link" style="padding: 0 3px; border-radius: 3px;">âœ“é•œåƒ</span> - è·³è½¬åˆ° HFé•œåƒ ä¸‹è½½é¡µé¢ (Go to HF Mirror download page)</li>
                    <li><span class="liblib-link" style="padding: 0 3px; border-radius: 3px;">âœ“LibLib</span> - è·³è½¬åˆ° LibLib æ¨¡å‹é¡µé¢ (Go to LibLib model page)</li>
                    <li>ä½¿ç”¨ "æ‰¹é‡å¤åˆ¶é•œåƒé“¾æ¥" æŒ‰é’®å¤åˆ¶å½“å‰å¯è§çš„ HF é•œåƒé“¾æ¥åˆ°å‰ªè´´æ¿ï¼Œå¯ç²˜è´´åˆ°ä¸‹è½½å·¥å…·ã€‚(Use "Batch Copy Mirror Links" button to copy visible HF Mirror links to clipboard for download tools.)</li>
                </ul>
            </div>
        
            <div class="controls-box">
                <div>
                    <label for="filterInput">ç­›é€‰æ¨¡å‹åç§° (Filter Model Name): </label>
                    <input type="text" id="filterInput" onkeyup="filterTable()" placeholder="è¾“å…¥å…³é”®è¯... (Enter keywords...)">
                </div>
            
                 <div>
                     <button id="copyButton" onclick="batchCopyMirrorLinks()">æ‰¹é‡å¤åˆ¶é•œåƒé“¾æ¥ (Batch Copy Mirror Links)</button>
                     <span id="copyMessage"></span>
                 </div>
                 </div><table id="modelTable">
<thead>
<tr>
<th onclick="sortTable(0)">åºå·<span class="filter-icon" onclick="event.stopPropagation(); showFilter(event, 0)">â–¼</span></th>
<th onclick="sortTable(1)">æ–‡ä»¶å<span class="filter-icon" onclick="event.stopPropagation(); showFilter(event, 1)">â–¼</span></th>
<th onclick="sortTable(2)">èŠ‚ç‚¹ID<span class="filter-icon" onclick="event.stopPropagation(); showFilter(event, 2)">â–¼</span></th>
<th onclick="sortTable(3)">èŠ‚ç‚¹ç±»å‹<span class="filter-icon" onclick="event.stopPropagation(); showFilter(event, 3)">â–¼</span></th>
<th onclick="sortTable(4)">HuggingFace<span class="filter-icon" onclick="event.stopPropagation(); showFilter(event, 4)">â–¼</span></th>
<th onclick="sortTable(5)">HFé•œåƒ (Mirror)<span class="filter-icon" onclick="event.stopPropagation(); showFilter(event, 5)">â–¼</span></th>
<th onclick="sortTable(6)">LibLib<span class="filter-icon" onclick="event.stopPropagation(); showFilter(event, 6)">â–¼</span></th>
<th onclick="sortTable(7)">çŠ¶æ€<span class="filter-icon" onclick="event.stopPropagation(); showFilter(event, 7)">â–¼</span></th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td class="file-name">TTPLANET_Controlnet_Tile_realistic_v2_fp16.safetensors</td>
<td>123</td>
<td>ControlNetLoader</td>
<td class="link-col hf-link"><a href="https://huggingface.co/TTPlanet/TTPLanet_SDXL_Controlnet_Tile_Realistic/resolve/main/TTPLANET_Controlnet_Tile_realistic_v2_fp16.safetensors" target="_blank" title="è·³è½¬åˆ°HuggingFaceæ¨¡å‹é¡µé¢ (Go to HuggingFace)">âœ“ HF</a></td>
<td class="link-col mirror-link"><a href="https://hf-mirror.com/TTPlanet/TTPLanet_SDXL_Controlnet_Tile_Realistic/resolve/main/TTPLANET_Controlnet_Tile_realistic_v2_fp16.safetensors" target="_blank" title="è·³è½¬åˆ°HFé•œåƒä¸‹è½½é¡µé¢ (Go to HF Mirror)">âœ“ é•œåƒ (Mirror)</a></td>
<td class="no-link">Ã— æš‚æ—  (None)</td>
<td class="status-processed">å·²å¤„ç†</td>
</tr>
<tr>
<td>2</td>
<td class="file-name">control_instant_id_sdxl.safetensors</td>
<td>127</td>
<td>ControlNetLoader</td>
<td class="link-col hf-link"><a href="https://huggingface.co/dominic1021/controls/resolve/main/control_instant_id_sdxl.safetensors" target="_blank" title="è·³è½¬åˆ°HuggingFaceæ¨¡å‹é¡µé¢ (Go to HuggingFace)">âœ“ HF</a></td>
<td class="link-col mirror-link"><a href="https://hf-mirror.com/dominic1021/controls/resolve/main/control_instant_id_sdxl.safetensors" target="_blank" title="è·³è½¬åˆ°HFé•œåƒä¸‹è½½é¡µé¢ (Go to HF Mirror)">âœ“ é•œåƒ (Mirror)</a></td>
<td class="no-link">Ã— æš‚æ—  (None)</td>
<td class="status-processed">å·²å¤„ç†</td>
</tr>
<tr>
<td>3</td>
<td class="file-name">dreamshaperXL_lightningDPMSDE.safetensors</td>
<td>49</td>
<td>CheckpointLoaderSimple</td>
<td class="link-col hf-link"><a href="https://huggingface.co/gingerlollipopdx/ModelsXL/resolve/main/dreamshaperXL_lightningDPMSDE.safetensors" target="_blank" title="è·³è½¬åˆ°HuggingFaceæ¨¡å‹é¡µé¢ (Go to HuggingFace)">âœ“ HF</a></td>
<td class="link-col mirror-link"><a href="https://hf-mirror.com/gingerlollipopdx/ModelsXL/resolve/main/dreamshaperXL_lightningDPMSDE.safetensors" target="_blank" title="è·³è½¬åˆ°HFé•œåƒä¸‹è½½é¡µé¢ (Go to HF Mirror)">âœ“ é•œåƒ (Mirror)</a></td>
<td class="no-link">Ã— æš‚æ—  (None)</td>
<td class="status-processed">å·²å¤„ç†</td>
</tr>
<tr>
<td>4</td>
<td class="file-name">face_yolov8m.pt</td>
<td>13</td>
<td>UltralyticsDetectorProvider</td>
<td class="link-col hf-link"><a href="https://huggingface.co/Bingsu/adetailer/resolve/main/face_yolov8m.pt" target="_blank" title="è·³è½¬åˆ°HuggingFaceæ¨¡å‹é¡µé¢ (Go to HuggingFace)">âœ“ HF</a></td>
<td class="link-col mirror-link"><a href="https://hf-mirror.com/Bingsu/adetailer/resolve/main/face_yolov8m.pt" target="_blank" title="è·³è½¬åˆ°HFé•œåƒä¸‹è½½é¡µé¢ (Go to HF Mirror)">âœ“ é•œåƒ (Mirror)</a></td>
<td class="no-link">Ã— æš‚æ—  (None)</td>
<td class="status-processed">å·²å¤„ç†</td>
</tr>
<tr>
<td>5</td>
<td class="file-name">ip-adapter.bin</td>
<td>125</td>
<td>InstantIDModelLoader</td>
<td class="link-col hf-link"><a href="https://huggingface.co/h94/IP-Adapter" target="_blank" title="è·³è½¬åˆ°HuggingFaceæ¨¡å‹é¡µé¢ (Go to HuggingFace)">âœ“ HF</a></td>
<td class="link-col mirror-link"><a href="https://hf-mirror.com/h94/IP-Adapter" target="_blank" title="è·³è½¬åˆ°HFé•œåƒä¸‹è½½é¡µé¢ (Go to HF Mirror)">âœ“ é•œåƒ (Mirror)</a></td>
<td class="no-link">Ã— æš‚æ—  (None)</td>
<td class="status-processed">å·²å¤„ç†</td>
</tr>
<tr>
<td>6</td>
<td class="file-name">sam_vit_b_01ec64.pth</td>
<td>14</td>
<td>SAMLoader</td>
<td class="link-col hf-link"><a href="https://huggingface.co/datasets/Gourieff/ReActor/resolve/main/models/sams/sam_vit_b_01ec64.pth" target="_blank" title="è·³è½¬åˆ°HuggingFaceæ¨¡å‹é¡µé¢ (Go to HuggingFace)">âœ“ HF</a></td>
<td class="link-col mirror-link"><a href="https://hf-mirror.com/datasets/Gourieff/ReActor/resolve/main/models/sams/sam_vit_b_01ec64.pth" target="_blank" title="è·³è½¬åˆ°HFé•œåƒä¸‹è½½é¡µé¢ (Go to HF Mirror)">âœ“ é•œåƒ (Mirror)</a></td>
<td class="no-link">Ã— æš‚æ—  (None)</td>
<td class="status-processed">å·²å¤„ç†</td>
</tr>
</tbody>
</table>

            <div class="summary">
                <p>æ€»è®°å½•æ•° (Total Records): 6</p>
            </div>
        
            <div id="filterDropdown" class="dropdown-content">
                <input type="text" class="dropdown-search" placeholder="æœç´¢ç­›é€‰é¡¹... (Search filter options...)" id="filterSearchInput" onkeyup="filterDropdownItems()">
                <div id="dropdown-items"></div>
                <div class="filter-buttons">
                    <button class="filter-apply" onclick="applyFilter()">åº”ç”¨ (Apply)</button>
                    <button class="filter-clear" onclick="clearFilter()">æ¸…é™¤ (Clear)</button>
                </div>
            </div>
        
            <script>
            // Pass Python variable to JS before the main script block
            var mirrorLinkColumnIndex = 5;
            </script>
        
            <script>
            // Global variables for filtering and table access
            var currentFilterColumn = -1;
            var currentFilterValues = {}; // Stores active filters: {colIndex: [value1, value2]}
            var modelTable = document.getElementById("modelTable");
            var tableHeaders = modelTable.querySelectorAll("thead th"); // Target thead headers
            var tableBody = modelTable.querySelector("tbody"); // Target tbody for rows
            // mirrorLinkColumnIndex is already defined in the previous script tag

            // --- Batch Copy Function ---
            function batchCopyMirrorLinks() {
                if (mirrorLinkColumnIndex < 0) {
                    alert("é”™è¯¯ï¼šæœªæ‰¾åˆ°é•œåƒé“¾æ¥åˆ—ï¼Œæ— æ³•å¤åˆ¶ã€‚(Error: Mirror link column not found, cannot copy.)");
                    return;
                }

                var links = [];
                var rows = tableBody.getElementsByTagName("tr");
                var copyButton = document.getElementById("copyButton");
                var copyMessage = document.getElementById("copyMessage");

                copyButton.disabled = true; // Disable button during copy
                copyMessage.textContent = "æ­£åœ¨å¤åˆ¶... (Copying...)";

                for (var i = 0; i < rows.length; i++) {
                    // Check if row is visible (not display: none)
                    if (rows[i].style.display !== "none") {
                        var cells = rows[i].getElementsByTagName("td");
                        if (cells.length > mirrorLinkColumnIndex) {
                            var cell = cells[mirrorLinkColumnIndex];
                            var linkElement = cell.querySelector("a"); // Find the link within the cell
                            if (linkElement && linkElement.href) {
                                links.push(linkElement.href);
                            }
                        }
                    }
                }

                if (links.length > 0) {
                    var linksText = links.join("\n"); // Join with newlines for Thunder
                    navigator.clipboard.writeText(linksText).then(function() {
                        copyMessage.textContent = `âœ“ å·²å¤åˆ¶ ${links.length} æ¡é“¾æ¥! (Copied ${links.length} links!)`;
                        copyButton.textContent = "å¤åˆ¶æˆåŠŸ (Copied!)";
                        setTimeout(() => { // Reset message and button after a delay
                            copyMessage.textContent = "";
                            copyButton.textContent = "æ‰¹é‡å¤åˆ¶é•œåƒé“¾æ¥ (Batch Copy Mirror Links)";
                            copyButton.disabled = false;
                        }, 3000); // Reset after 3 seconds
                    }, function(err) {
                        copyMessage.textContent = "å¤åˆ¶å¤±è´¥! (Copy failed!)";
                        console.error('Async: Could not copy text: ', err);
                        alert("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æƒé™æˆ–æ‰‹åŠ¨å¤åˆ¶ã€‚(Copy failed. Check browser permissions or copy manually.)");
                        copyButton.disabled = false; // Re-enable button on failure
                        copyButton.textContent = "æ‰¹é‡å¤åˆ¶é•œåƒé“¾æ¥ (Batch Copy Mirror Links)";
                    });
                } else {
                    copyMessage.textContent = "æ²¡æœ‰å¯è§çš„é•œåƒé“¾æ¥å¯å¤åˆ¶ã€‚(No visible mirror links to copy.)";
                     setTimeout(() => {
                         copyMessage.textContent = "";
                         copyButton.disabled = false;
                         copyButton.textContent = "æ‰¹é‡å¤åˆ¶é•œåƒé“¾æ¥ (Batch Copy Mirror Links)";
                     }, 3000);
                }
            }

            // --- Sorting Function ---
            function sortTable(n) {
                var switching, i, x, y, shouldSwitch, dir, switchcount = 0;
                switching = true;
                dir = "asc"; // Default sort direction

                // Get current sort direction from header icon if available
                var currentIcon = tableHeaders[n].querySelector(".filter-icon").textContent;
                if (currentIcon === "â–²") {
                    dir = "desc"; // If already ascending, switch to descending
                }

                while (switching) {
                    switching = false;
                    var rows = tableBody.getElementsByTagName("tr"); // Use tbody rows

                    for (i = 0; i < (rows.length - 1); i++) {
                        shouldSwitch = false;
                        x = rows[i].getElementsByTagName("TD")[n];
                        y = rows[i + 1].getElementsByTagName("TD")[n];

                        var xText = x.textContent || x.innerText;
                        var yText = y.textContent || y.innerText;

                        // Handle link columns ('âœ“' vs 'Ã—')
                        var xIsLink = x.querySelector("a") !== null;
                        var yIsLink = y.querySelector("a") !== null;

                        if (x.classList.contains('link-col') || x.classList.contains('no-link')) {
                             if (dir == "asc") { // Links first
                                 shouldSwitch = !xIsLink && yIsLink;
                             } else { // No links first
                                 shouldSwitch = xIsLink && !yIsLink;
                             }
                             // If both are links or both not links, sort by text (e.g., "âœ“ HF" vs "âœ“ Mirror")
                             if (xIsLink === yIsLink) {
                                 if (dir == "asc") {
                                     shouldSwitch = xText.toLowerCase() > yText.toLowerCase();
                                 } else {
                                     shouldSwitch = xText.toLowerCase() < yText.toLowerCase();
                                 }
                             }
                        } else {
                            // Attempt numeric sort first
                            var xNum = parseFloat(xText.replace(/,/g, '')); // Handle commas in numbers
                            var yNum = parseFloat(yText.replace(/,/g, ''));

                            if (!isNaN(xNum) && !isNaN(yNum)) {
                                if (dir == "asc") {
                                    shouldSwitch = xNum > yNum;
                                } else {
                                    shouldSwitch = xNum < yNum;
                                }
                            } else {
                                // Fallback to string comparison
                                if (dir == "asc") {
                                    shouldSwitch = xText.toLowerCase() > yText.toLowerCase();
                                } else {
                                    shouldSwitch = xText.toLowerCase() < yText.toLowerCase();
                                }
                            }
                        }


                        if (shouldSwitch) {
                            rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                            switching = true;
                            switchcount++;
                            break; // Break after a switch and restart loop
                        }
                    }
                }

                // Update header icons
                for (var k = 0; k < tableHeaders.length; k++) {
                    var icon = tableHeaders[k].querySelector(".filter-icon");
                    // Reset non-active sort/filter icons, keep active filter icons
                     if (!icon.textContent || icon.textContent === "â–²" || icon.textContent === "â–¼") {
                         // Check if filter is active for this column (k) and if it's not filtering everything out
                         var isFullyFiltered = currentFilterValues[k] && currentFilterValues[k].length === 0; // No values selected means filter is active but shows nothing
                         var isPartiallyFiltered = currentFilterValues[k] && currentFilterValues[k].length > 0 && (tableBody.rows.length > 0 ? currentFilterValues[k].length < new Set(Array.from(tableBody.rows).map(r => r.cells[k].textContent.trim())).size : false);

                         if (k !== n && (isFullyFiltered || isPartiallyFiltered)) {
                             // If it's not the column being sorted AND it has an active filter, keep the filter icon
                             icon.textContent = "ğŸ”";
                         } else if (k !==n) {
                             // Otherwise, reset to default arrow if it's not the sorted column
                             icon.textContent = "â–¼";
                         }
                     } else if (k !== n && icon.textContent === "ğŸ”") {
                         // Keep filter icon if it's already there and not the column being sorted
                          icon.textContent = "ğŸ”";
                     } else if (k !== n) {
                        // Default reset for non-sorted, non-filtered columns
                        icon.textContent = "â–¼";
                     }
                }
                 // Set the current sort icon for the column that was just sorted (n)
                 tableHeaders[n].querySelector(".filter-icon").textContent = (dir === "asc") ? "â–²" : "â–¼";
            }


            // --- Global Text Filter Function ---
            function filterTable() {
                var input, filter, tr, td, i, j, txtValue, found;
                input = document.getElementById("filterInput");
                filter = input ? input.value.toUpperCase() : ""; // Handle case where input might not exist
                tr = tableBody.getElementsByTagName("tr");

                for (i = 0; i < tr.length; i++) {
                    // First check column filters
                    if (!passesColumnFilters(tr[i])) {
                        tr[i].style.display = "none";
                        continue;
                    }

                    // Then check global text filter (if input exists)
                    if (filter === "") {
                        tr[i].style.display = ""; // Show if no global filter and passes column filters
                        continue;
                    }

                    td = tr[i].getElementsByTagName("td");
                    found = false;
                    for (j = 0; j < td.length; j++) {
                        txtValue = td[j].textContent || td[j].innerText;
                        if (txtValue.toUpperCase().indexOf(filter) > -1) {
                            found = true;
                            break;
                        }
                    }
                    tr[i].style.display = found ? "" : "none";
                }
            }

            // --- Column Filter Dropdown Functions ---
            function showFilter(event, colIndex) {
                var dropdown = document.getElementById("filterDropdown");
                currentFilterColumn = colIndex; // Set the column being filtered

                // Position dropdown below the icon
                var icon = event.target; // Should be the span icon
                var th = icon.closest('th'); // Get the parent th
                var rect = th.getBoundingClientRect(); // Use th for positioning base
                var iconRect = icon.getBoundingClientRect(); // Use icon for fine-tuning

                dropdown.style.left = rect.left + window.scrollX + "px";
                // Position below the icon itself, not the whole header cell bottom
                dropdown.style.top = iconRect.bottom + window.scrollY + 5 + "px";
                dropdown.style.minWidth = Math.max(180, rect.width) + "px"; // Base width on header cell

                populateDropdown(colIndex); // Fill with options
                dropdown.classList.add("show");
                document.getElementById('filterSearchInput').value = ''; // Clear search
                filterDropdownItems(); // Show all items initially

                // Close dropdown if clicked outside
                 // Use setTimeout to defer adding the listener slightly
                setTimeout(() => {
                    window.onclick = function(closeEvent) {
                        // Close if click is outside dropdown AND outside the filter icon that opened it
                        if (!dropdown.contains(closeEvent.target) && !icon.contains(closeEvent.target)) {
                            dropdown.classList.remove("show");
                            window.onclick = null; // Remove listener after closing
                        }
                    }
                }, 0);
            }

            function populateDropdown(colIndex) {
                var rows = tableBody.getElementsByTagName("tr");
                var uniqueValues = new Set();

                // Collect unique values from the column
                for (var i = 0; i < rows.length; i++) {
                    // Only consider rows currently potentially visible (respects global filter, but not column filters yet)
                    // This prevents options disappearing entirely if globally filtered out.
                    // We will rely on passesColumnFilters later.
                    // if (rows[i].style.display !== "none") { // Optimization: only check visible rows? Might hide options. Let's check all.
                        if (rows[i].cells.length > colIndex) {
                            var cell = rows[i].cells[colIndex];
                            var value = (cell.textContent || cell.innerText).trim();
                            uniqueValues.add(value);
                        }
                    // }
                }

                var sortedValues = Array.from(uniqueValues).sort();
                var dropdownItemsDiv = document.getElementById("dropdown-items");
                dropdownItemsDiv.innerHTML = ""; // Clear previous items

                // Add "Select All"
                var allItem = document.createElement("div");
                allItem.className = "dropdown-item";
                allItem.innerHTML = '<input type="checkbox" id="select-all" onchange="toggleAll(this.checked)"> <label for="select-all">å…¨é€‰ (Select All)</label>';
                dropdownItemsDiv.appendChild(allItem);
                dropdownItemsDiv.appendChild(document.createElement("hr")); // Separator

                // Add items for each unique value
                var activeFilters = currentFilterValues[colIndex] || null; // Get active filters for this column

                sortedValues.forEach(function(value, index) {
                    var item = document.createElement("div");
                    item.className = "dropdown-item";
                    var checkboxId = "filter-item-" + index;
                    // Check if this value should be checked (either no filter active, or this value is in the active filter list)
                    var isChecked = !activeFilters || activeFilters.includes(value);

                    item.innerHTML = `<input type="checkbox" id="${checkboxId}" value="${value}" ${isChecked ? "checked" : ""}> <label for="${checkboxId}">${value || '(Blank)'}</label>`; // Handle blank values
                    dropdownItemsDiv.appendChild(item);
                });

                updateSelectAllCheckbox(); // Set initial state of "Select All"
            }

            function filterDropdownItems() {
                var input = document.getElementById("filterSearchInput");
                var filter = input.value.toUpperCase();
                var items = document.querySelectorAll("#dropdown-items .dropdown-item:not(:first-child)"); // Exclude "Select All"

                items.forEach(function(item) {
                    var label = item.querySelector("label");
                    var text = label ? (label.textContent || label.innerText) : "";
                    item.style.display = text.toUpperCase().indexOf(filter) > -1 ? "" : "none";
                });
                 updateSelectAllCheckbox(); // Update select all based on visible items
            }

            function applyFilter() {
                var selectedValues = [];
                var checkboxes = document.querySelectorAll("#dropdown-items .dropdown-item:not(:first-child) input[type='checkbox']");
                var allPossibleValuesInDropdown = []; // All values currently in the dropdown (before filtering)

                 // Re-populate the unique values set to get ALL possible values for this column
                 var allRows = tableBody.getElementsByTagName("tr");
                 var allUniqueValuesSet = new Set();
                 for (var i = 0; i < allRows.length; i++) {
                     if (allRows[i].cells.length > currentFilterColumn) {
                         allUniqueValuesSet.add((allRows[i].cells[currentFilterColumn].textContent || allRows[i].cells[currentFilterColumn].innerText).trim());
                     }
                 }
                 allPossibleValuesInDropdown = Array.from(allUniqueValuesSet);


                checkboxes.forEach(function(checkbox) {
                    // allPossibleValuesInDropdown.push(checkbox.value); // Collect all values represented by checkboxes
                    if (checkbox.checked) {
                        selectedValues.push(checkbox.value);
                    }
                });

                var filterIcon = tableHeaders[currentFilterColumn].querySelector(".filter-icon");

                // Update filter state
                // Check if the number of selected values equals the total number of unique values for that column
                if (selectedValues.length === allPossibleValuesInDropdown.length || selectedValues.length === 0) {
                    // If all unique values are selected, or none are selected, treat as no filter active for this column
                    delete currentFilterValues[currentFilterColumn];
                    // Reset icon only if it wasn't a sort icon (â–² or â–¼)
                    if (filterIcon.textContent === "ğŸ”") {
                       // Check if it's also the sort column, if so, restore sort icon, otherwise default
                       var currentSortIcon = tableHeaders[currentFilterColumn].matches('[aria-sort]') ? (tableHeaders[currentFilterColumn].getAttribute('aria-sort') === 'ascending' ? 'â–²' : 'â–¼') : 'â–¼'; // A bit complex, maybe simplify
                       filterIcon.textContent = "â–¼"; // Simplified: just reset to default arrow when filter cleared
                    }
                } else {
                    // Otherwise, apply the filter with the selected values
                    currentFilterValues[currentFilterColumn] = selectedValues;
                    filterIcon.textContent = "ğŸ”"; // Set filter indicator
                }


                document.getElementById("filterDropdown").classList.remove("show");
                filterTable(); // Re-apply filters to the main table
            }

            function clearFilter() {
                 // Clear filter for the current column
                 if (currentFilterColumn in currentFilterValues) {
                     delete currentFilterValues[currentFilterColumn];
                 }

                 // Reset header icon (only if it's the filter icon)
                 var filterIcon = tableHeaders[currentFilterColumn].querySelector(".filter-icon");
                 if (filterIcon.textContent === "ğŸ”") {
                    filterIcon.textContent = "â–¼"; // Reset to default
                 }


                 // Check all checkboxes in the dropdown (even hidden ones by search)
                 var checkboxes = document.querySelectorAll("#dropdown-items .dropdown-item input[type='checkbox']");
                 checkboxes.forEach(function(checkbox) { checkbox.checked = true; });

                 document.getElementById("filterDropdown").classList.remove("show");
                 filterTable(); // Re-apply filters
            }

            function toggleAll(checked) {
                var checkboxes = document.querySelectorAll("#dropdown-items .dropdown-item:not(:first-child) input[type='checkbox']");
                checkboxes.forEach(function(checkbox) {
                    // Only toggle visible checkboxes (respecting dropdown search)
                    if (checkbox.closest('.dropdown-item').style.display !== "none") {
                        checkbox.checked = checked;
                    }
                });
            }

            function updateSelectAllCheckbox() {
                 var allCheckbox = document.getElementById("select-all");
                 if (!allCheckbox) return; // Should exist, but safety check

                 var checkboxes = document.querySelectorAll("#dropdown-items .dropdown-item:not(:first-child) input[type='checkbox']");
                 var allVisibleChecked = true;
                 var noneVisibleChecked = true;
                 var anyVisible = false;

                 checkboxes.forEach(function(checkbox) {
                     // Only consider checkboxes that are currently visible in the dropdown
                     if (checkbox.closest('.dropdown-item').style.display !== "none") {
                         anyVisible = true;
                         if (checkbox.checked) {
                             noneVisibleChecked = false;
                         } else {
                             allVisibleChecked = false;
                         }
                     }
                 });

                 if (!anyVisible) { // Handle case where search filters out everything
                     allCheckbox.checked = false;
                     allCheckbox.indeterminate = false;
                 } else {
                     allCheckbox.checked = allVisibleChecked;
                     // Indeterminate if some visible items are checked, but not all visible items are checked
                     allCheckbox.indeterminate = !allVisibleChecked && !noneVisibleChecked;
                 }
            }

            // Check if a row passes all active column filters
            function passesColumnFilters(row) {
                var cells = row.getElementsByTagName("td");
                for (var colIdx in currentFilterValues) {
                    // Ensure colIdx is a valid index for the row's cells
                    if (cells.length > colIdx) {
                        var cellValue = (cells[colIdx].textContent || cells[colIdx].innerText).trim();
                        var allowedValues = currentFilterValues[colIdx]; // This is the array of selected values for this column's filter

                        // If there's an active filter for this column (allowedValues exists)
                        // AND the current cell's value is NOT in the list of allowed values...
                        if (allowedValues && !allowedValues.includes(cellValue)) {
                            return false; // ...then this row fails the filter
                        }
                    }
                }
                return true; // Passes all active filters (or no filters are active)
            }

            // Initial setup: Apply any default filters if needed (usually none)
            // filterTable(); // Call once on load if you have default filters

            </script>
        
        </body>
        </html>
        